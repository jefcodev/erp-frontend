<!-- Table Data Factura -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">

                <!-- Button Groups  -->
                <div class="float-left">
                    <button class="btn btn-info waves-effect waves-light" data-toggle="modal"
                        data-target="#exampleModal" type="button">
                        <span class="fa fa-plus" style="padding-left:0px;"></span>&nbsp;Nueva
                    </button>
                    <button class="btn btn-new-version waves-effect waves-light" data-toggle="modal"
                        data-target="#exampleModalXML" type="button">
                        <span class="fa fa-upload" style="padding-left:0px;"></span>&nbsp;Subir
                    </button>
                    <button class="btn btn-success" type="button">
                        <span class="fa fa-file-pdf-o" style="padding-left:0px;"></span>&nbsp;PDF
                    </button>
                    <button class="btn btn-success" type="button">
                        <span class="fa fa-file-excel-o" style="padding-left:0px;"></span>&nbsp;Excel
                    </button>
                    <button class="btn btn-success" type="button" onclick="">
                        <span class="fa fa-print" style="padding-left:0px;"></span>&nbsp;Imprimir
                    </button>
                    <div id="example23_filter" class="dataTables_filter"><label>Buscar:<input type="search" class=""
                                placeholder="" aria-controls="example23"></label>
                    </div>
                </div>

                <!-- Table Data -->
                <div class="table-responsive">
                    <table id="demo-foo-addrow" class="table m-t-30 table-hover contact-list footable-loaded footable"
                        data-page-size="10">
                        <thead>
                            <tr>
                                <th class="footable-sortable">#<span class="footable-sort-indicator"></span></th>
                                <th class="footable-sortable">Fecha<span class="footable-sort-indicator"></span>
                                </th>
                                <th class="footable-sortable">Número<span class="footable-sort-indicator"></span></th>
                                <th class="footable-sortable">Identificación<span
                                        class="footable-sort-indicator"></span>
                                </th>
                                <th class="footable-sortable">Razón Social<span class="footable-sort-indicator"></span>
                                </th>
                                <th class="footable-sortable">Fecha Vencimiento<span
                                        class="footable-sort-indicator"></span>
                                </th>
                                <th class="footable-sortable text-center">Valor Total<span
                                        class="footable-sort-indicator"></span>
                                </th>
                                <th class="footable-sortable text-center">Abono<span
                                        class="footable-sort-indicator"></span>
                                </th>
                                <th class="footable-sortable">Saldo<span class="footable-sort-indicator"></span>
                                </th>
                                <th class="footable-sortable">Estado Pago<span class="footable-sort-indicator"></span>
                                </th>
                                <th class="footable-sortable">Asiento<span class="footable-sort-indicator"></span>
                                </th>
                                <th class="footable-sortable">Estado<span class="footable-sort-indicator"></span></th>
                                <th class="footable-sortable text-center">Action<span
                                        class="footable-sort-indicator"></span></th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr *ngFor="let factura of facturas let i = index">
                                <td><span class="footable-toggle"></span>{{ i + 1 }}</td>
                                <td>{{factura.fecha_emision | date:'yyyy-MM-dd' }}</td>
                                <td>{{factura.codigo}}</td>
                                <td>
                                    <ng-container *ngFor="let proveedor of proveedores">
                                        <ng-container
                                            *ngIf="proveedor.id_proveedor == factura.id_proveedor ">{{proveedor.identificacion}}</ng-container>
                                    </ng-container>
                                </td>
                                <td>
                                    <ng-container *ngFor="let proveedor of proveedores">
                                        <ng-container
                                            *ngIf="proveedor.id_proveedor == factura.id_proveedor ">{{proveedor.razon_social}}</ng-container>
                                    </ng-container>
                                </td>

                                <td>{{ factura.fecha_vencimiento | date:'yyyy-MM-dd' }}</td>
                                <td class="text-right">{{ factura.importe_total }}</td>
                                <td class="text-right">{{ factura.abono }}</td>
                                <td class="text-right">{{ (factura.importe_total - factura.abono) | number:'1.2-2' }}
                                </td>
                                <td>
                                    <ng-container [ngSwitch]="factura.estado_pago">
                                        <div *ngSwitchCase="'PAGADO'" class="label label-table label-success">PAGADO
                                        </div>
                                        <div *ngSwitchCase="'PENDIENTE'" class="label label-table label-info">PENDIENTE
                                        </div>
                                        <div *ngSwitchCase="'VENCIDA'" class="label label-table label-warning">VENCIDA
                                        </div>
                                        <div *ngSwitchCase="'ANULADA'" class="label label-table label-danger">ANULADA
                                        </div>
                                        <div *ngSwitchDefault class="label label-table label-info">{{
                                            factura.estado_pago }}
                                        </div>
                                    </ng-container>
                                </td>

                                <td class="text-center">{{ factura.id_asiento }}</td>
                                <td *ngIf="factura.estado; else inactivo">
                                    <div class="label label-table label-success">ACTIVA</div>
                                </td>
                                <ng-template #inactivo>
                                    <td>
                                        <div class="label label-table label-danger">ANULADA</div>
                                    </td>
                                </ng-template>

                                <td *ngIf="factura.estado else inactivoOption" class="text-nowrap text-center">

                                    <a class="cursor" data-toggle="modal"
                                        (click)="cargarFacturaPorId(factura.id_factura_compra); cargarDetalleFacturas(factura.id_factura_compra)"
                                        data-target="#exampleModalU"><span
                                            class="fa fa-pencil text-inverse m-r-10"></span></a>

                                    <a class="cursor" (click)="borrarFactura(factura);" data-toggle="tooltip"
                                        data-original-title="Close"> <i class="fa fa-close text-danger"></i> </a>
                                </td>
                                <ng-template #inactivoOption>
                                </ng-template>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="8">
                                    <div class="text-right">
                                        <ul class="pagination">
                                            <li class="footable-page-arrow disabled"><a data-page="first"
                                                    href="#first">«</a></li>
                                            <li class="footable-page-arrow disabled"><a data-page="prev"
                                                    href="#prev">‹</a>
                                            </li>
                                            <li class="footable-page-arrow"><a data-page="next" href="#next">›</a></li>
                                            <li class="footable-page-arrow"><a data-page="last" href="#last">»</a></li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Create Factura -->
<div class="modal fade modal-principal" id="exampleModal" tabindex="-1" role="dialog"
    aria-labelledby="exampleModalLabel1" #miModal>
    <div class="modal-dialog" role="document" style="width: 100%;" max-width="1000px;">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title" id="exampleModalLabel1">Nueva Factura</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">

                <div class="text-center">
                    <h3><b>FACTURA COMPRA</b></h3>
                    <h5><b>#</b></h5>
                </div>

                <form autocomplete="off" [formGroup]="facturaForm">

                    <!-- Factura Form -->
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Proveedor </label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-id-badge"></i></div>
                                    <!--se aumento id="exampleInputuname"-->
                                    <input type="text" class="form-control" id="exampleInputuname"
                                        placeholder="Buscar identificación" formControlName="identificacion"
                                        (input)="filtrarProveedores3($event)">
                                    <button class="btn btn-success" data-toggle="modal" data-target="#modalProveedor"
                                        type="button">
                                        Nuevo <span class="fa fa-plus" style="padding-left: 10px;"></span>
                                    </button>
                                </div>
                                <div class="proveedores-filtrados" *ngIf="proveedoresFiltrados.length > 0">
                                    <ul class="list-group">
                                        <li class="list-group-item" *ngFor="let proveedor of proveedoresFiltrados"
                                            (click)="seleccionarProveedor3(proveedor)">
                                            {{ proveedor.identificacion }}
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Razón Social</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-user"></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname"
                                        placeholder="Razón Social" formControlName="razon_social"
                                        [value]="razonSocialProveedor" readonly>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Dirección</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-location-pin"></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname"
                                        placeholder="Dirección" formControlName="direccion" [value]="direccionProveedor"
                                        readonly>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Teléfono</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-mobile"></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname"
                                        placeholder="Teléfono" formControlName="telefono" [value]="telefonoProveedor"
                                        readonly>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Email</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-email"></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname" placeholder="Email"
                                        formControlName="email" [value]="emailProveedor" readonly>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Forma de pago</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-credit-card"></i></div>
                                    <select class="form-control" formControlName="id_forma_pago">
                                        <option *ngFor="let fp of formas_pago" [value]="fp.id_forma_pago">
                                            {{ fp.codigo }} - {{ fp.descripcion }}
                                        </option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">No. Factura</label>
                                <div class="input-group">
                                    <div class="input-group-addon">#<i class=""></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname"
                                        placeholder="Número de factura" formControlName="codigo">
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Fecha emisión</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-calendar"></i></div>
                                    <input type="date" class="form-control" id="exampleInputuname"
                                        placeholder="Fecha Emisión" formControlName="fecha_emision">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Fecha vencimiento</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-calendar"></i></div>
                                    <input type="date" class="form-control" id="exampleInputuname"
                                        placeholder="Fecha Vencimiento" formControlName="fecha_vencimiento">
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="text-danger">
                                <p *ngIf="campoNoValido('email',facturaForm)">El campo email es obligatorio</p>
                            </div>
                        </div>

                        <hr>
                    </div>

                    <!-- Detalle Table Form -->
                    <form autocomplete="off" [formGroup]="detalleFacturaForm">
                        <div class="table-responsive m-t-5" style="clear: both;">
                            <table class="table table-hover">
                                <thead>
                                    <th class="text-center">#</th>
                                    <th class="text-right">Producto</th>
                                    <th class="text-right">Código Principal</th>
                                    <th class="text-right">Cantidad</th>
                                    <th class="text-right">Descripción</th>
                                    <th class="text-right">Precio U.</th>
                                    <th class="text-right">Descuento</th>
                                    <th class="text-right">Valor Total</th>
                                    <th class="text-right">Tarifa</th>
                                    <th class="text-right">Valor</th>
                                    <th class="text-right">ICE</th>
                                    <th class="text-right">Precio Total</th>
                                    <th class="text-right">Acción</th>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let detalle of detalleFacturaFormulario; let i = index">
                                        <td class="text-center">{{ i + 1 }}</td>
                                        <td><select class="form-control" formControlName="producto_{{i}}">
                                                <option *ngFor="let producto of productos"
                                                    [value]="producto.id_producto">{{
                                                    producto.id_producto + ' - ' + producto.descripcion }}</option>
                                            </select>
                                        </td>
                                        <td><input type="text" class="form-control"
                                                formControlName="codigo_principal_{{i}}">
                                        </td>
                                        <td><input type="number" class="form-control" formControlName="cantidad_{{i}}"
                                                (input)="calcularPrecioTotalSinImpuestoConDescuento(i)"
                                                (input)="calcularValor(i)" (input)="calcularPrecioTotal(i)"
                                                (input)="actualizarTotalesPorTarifa()"
                                                (input)="actualizarTotalSinImpuestos()" (input)="actualizarTotalIVA()"
                                                (input)="actualizarPrecioTotal()" (input)="actualizarSaldo()"
                                                min="0">
                                        </td>
                                        <td><input type="text" class="form-control" formControlName="descripcion_{{i}}">
                                        </td>
                                        <td><input type="number" class="form-control"
                                                formControlName="precio_unitario_{{i}}"
                                                (input)="calcularPrecioTotalSinImpuestoConDescuento(i)"
                                                (input)="calcularValor(i)" (input)="calcularPrecioTotal(i)"
                                                (input)="actualizarTotalesPorTarifa()"
                                                (input)="actualizarTotalSinImpuestos()" (input)="actualizarTotalIVA()"
                                                (input)="actualizarPrecioTotal()" (input)="actualizarSaldo()"
                                                min="0">
                                        </td>
                                        <td><input type="number" class="form-control" formControlName="descuento_{{i}}"
                                                (input)="calcularPrecioTotalSinImpuestoConDescuento(i)"
                                                (input)="calcularValor(i)" (input)="calcularPrecioTotal(i)"
                                                (input)="actualizarTotalDescuento()"
                                                (input)="actualizarTotalesPorTarifa()"
                                                (input)="actualizarTotalSinImpuestos()" (input)="actualizarTotalIVA()"
                                                (input)="actualizarPrecioTotal()" (input)="actualizarSaldo()"
                                                min="0">
                                        </td>
                                        <td><input type="number" class="form-control"
                                                formControlName="precio_total_sin_impuesto_{{i}}" readonly></td>

                                        <td><input type="number" class="form-control" formControlName="tarifa_{{i}}">
                                        </td>
                                        <td><input type="number" class="form-control" formControlName="valor_{{i}}"
                                                readonly>
                                        </td>
                                        <td><input type="number" class="form-control" formControlName="ice_{{i}}"
                                                (input)="calcularPrecioTotalSinImpuestoConDescuento(i)"
                                                (input)="calcularValor(i)" (input)="calcularPrecioTotal(i)"
                                                (input)="actualizarTotalesPorTarifa()"
                                                (input)="actualizarTotalSinImpuestos()" (input)="actualizarTotalIVA()"
                                                (input)="actualizarPrecioTotal()" (input)="actualizarTotalICE()"
                                                (input)="actualizarSaldo()"
                                                min="0">
                                        </td>

                                        <td><input type="number" class="form-control"
                                                formControlName="precio_total_{{i}}" readonly>
                                        </td>
                                        <td class="text-right">
                                            <button type="button" class="btn btn-danger btn-sm"
                                                (click)="eliminarDetalleForm(i)">
                                                <i class="ti-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <button id="agregarLinea" class="btn btn-success" (click)="agregarDetalleForm()">
                                        Agregar <span class="fa fa-plus" style="padding-left: 10px;"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>

                    <!-- Factura Form 2 -->
                    <div class="col-md-12">
                        <div class="clearfix"></div>
                        <hr>
                        <div class="row">

                            <!-- Espaciador -->
                            <div class="col-md-3"></div>

                            <!-- Pago de Factura -->
                            <div class="col-md-3">
                                <br>
                                <div class="form-group">
                                    <label for="exampleInputuname">PAGO DE FACTURA</label>
                                    <div class="input-group">
                                        <div class="input-group-addon"><b>Abonar:</b><i class=""></i></div>
                                        <input type="number" class="form-control text-right" id="exampleInputuname"
                                            placeholder="0.00" formControlName="abono" (input)="actualizarSaldo()" min="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="input-group">
                                        <div class="input-group-addon"><b>Saldo:</b>&nbsp;&nbsp;&nbsp;&nbsp;<i
                                                class=""></i></div>
                                        <input type="number" class="form-control text-right" id="exampleInputuname"
                                            placeholder="{{ facturaForm.get('saldo')?.value }}" formControlName="saldo"
                                            readonly>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="input-group">
                                        <div class="input-group-addon"><b>Total:</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i
                                                class=""></i></div>
                                        <input type="number" class="form-control text-right" id="exampleInputuname"
                                            placeholder="{{ sumaPrecioTotal.toFixed(2) }}"
                                            formControlName="importe_total" readonly>
                                    </div>
                                </div>

                            </div>

                            <!-- Detalle -->
                            <div class="col-md-3">
                                <div class="pull-right m-t-30 text-right">
                                    <p>SUBTOTAL SIN IMPUESTOS: </p>
                                    <p>SUBTOTAL 12%: </p>
                                    <p>SUBTOTAL 0%: </p>
                                    <p>SUBTOTAL NO OBJETO DE IVA: </p>
                                    <p>SUBTOTAL EXCENTO DE IVA: </p>
                                    <p>TOTAL DESCUENTO: </p>
                                    <p>ICE:</p>
                                    <p>IVA 12%: </p>
                                    <h3 class="left-align"><b>VALOR TOTAL: </b></h3>
                                </div>
                            </div>

                            <!-- Valores -->
                            <div class="col-md-3">
                                <div class="pull-right m-t-30 text-right">
                                    <p>$ {{ sumaTotalSinImpuesto.toFixed(2) }} </p>
                                    <p>$ {{ sumaTotalImpuesto.toFixed(2) }} </p>
                                    <p>$ {{ sumaTotalImpuestoCero.toFixed(2) }} </p>
                                    <p>$ 0.00 </p> <!-- Valor fijo en 0.00 -->
                                    <p>$ 0.00 </p> <!-- Valor fijo en 0.00 -->
                                    <p>$ {{ sumaTotalDescuento.toFixed(2) }} </p>
                                    <p>$ {{ sumaTotalICE.toFixed(2) }} </p>
                                    <p>$ {{ sumaTotalIVA.toFixed(2) }} </p>
                                    <h3>$ {{ sumaPrecioTotal.toFixed(2) }} </h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Modal Footer -->
            <div class="col-md-12">
                <hr>
                <div class="float-right modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" (click)="crearFactura();"
                        data-dismiss="modal">Guardar</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Upload XML -->
<div class="modal fade modal-principal" id="exampleModalXML" tabindex="-1" role="dialog"
    aria-labelledby="exampleModalLabel1" #miModal>
    <div class="modal-dialog" role="document" style="width: 100%;" max-width="1000px;">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title" id="exampleModalLabel1">Cargar Factura</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">

                <div class="text-center">
                    <h3><b>FACTURA COMPRA</b></h3>
                    <h5><b># </b> {{ estab }}-{{ ptoEmi }}-{{ secuencial }}</h5>
                </div>

                <form autocomplete="off" [formGroup]="facturaFormXML">

                    <!-- Factura Form -->
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Identificación</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-id-badge"></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname"
                                        placeholder="{{ ruc }}" formControlName="identificacion" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Razó Social</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-user"></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname"
                                        placeholder='{{ razonSocial }}' formControlName="razon_social" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Dirección</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-location-pin"></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname"
                                        placeholder='{{ dirEstablecimiento }}' formControlName="direccion" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Teléfono</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-mobile"></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname"
                                        placeholder="Télefono" formControlName="telefono" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Email</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-email"></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname" placeholder="Email"
                                        formControlName="email" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Forma de pago</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-credit-card"></i></div>

                                    <input type="text" class="form-control" id="exampleInputuname"
                                        placeholder='{{ formaPago }}' formControlName="id_forma_pago" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Fecha Emisión</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-calendar"></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname"
                                        placeholder="{{ fechaEmision }}" formControlName="fecha_emision"
                                        [value]="getFormattedFechaEmision()" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Fecha vencimiento</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-calendar"></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname"
                                        placeholder="Fecha Vencimiento" formControlName="fecha_vencimiento"
                                        [value]="getFormattedFechaVencimiento()" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Estado de pago</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-check-box"></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname"
                                        placeholder="Estado de Pago" formControlName="estado_pago" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Subir XML</label>
                                <div class="input-group">
                                    <input type="file" (change)="onFileSelected($event)" id="fileInput"
                                        style="display: none;">
                                    <label for="fileInput" class="custom-file-upload">
                                        <i class="ti-upload"></i> Seleccionar archivo
                                    </label>
                                </div>
                                <h5 id="selectedFileName"></h5>
                            </div>
                        </div>

                        <!-- Field Validation 
                        <div class="col">
                            <div class="text-danger">
                                <p *ngIf="campoNoValido('estado_pago',facturaFormU)">El campo es obligatorio</p>
                            </div>
                        </div>
                    -->
                        <!-- <hr>-->
                    </div>

                    <!-- Detalle Table Form -->
                    <div class="table-responsive">

                        <table id="demo-foo-addrow"
                            class="table m-t-30 table-hover contact-list footable-loaded footable" data-page-size="10">
                            <thead>
                                <tr>
                                    <th class="footable-sortable">#<span class="footable-sort-indicator"></span>
                                    </th>
                                    <th class="footable-sortable text-center">Código <span
                                            class="footable-sort-indicator"></span>
                                    </th>
                                    <th class="footable-sortable">Cant.<span class="footable-sort-indicator"></span>
                                    </th>
                                    <th class="footable-sortable">Descripcion<span
                                            class="footable-sort-indicator"></span>
                                    </th>
                                    <th class="footable-sortable">Precio Unitario<span
                                            class="footable-sort-indicator"></span>
                                    </th>
                                    <th class="footable-sortable">Descuento<span class="footable-sort-indicator"></span>
                                    </th>
                                    <th class="footable-sortable">Valor Total<span
                                            class="footable-sort-indicator"></span>
                                    </th>
                                    <th class="footable-sortable">Tarifa<span class="footable-sort-indicator"></span>
                                    </th>
                                    <th class="footable-sortable">Valor<span class="footable-sort-indicator"></span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of detallesXML; let i = index">
                                    <td class="text-center">{{ i + 1 }}</td>
                                    <td>{{ item.codigoPrincipal }}</td>
                                    <td>{{ item.cantidad }}</td>
                                    <td>{{ item.descripcion }}</td>
                                    <td>{{ item.precioUnitario }}</td>
                                    <td>{{ item.descuento }}</td>
                                    <td>{{ item.precioTotalSinImpuesto }}</td>
                                    <td>{{ item.tarifa }}%</td>
                                    <td>{{ item.valor }}</td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <!--paginador-->
                                </tr>
                            </tfoot>
                        </table>
                    </div>

                    <!-- Factura Form 2 -->
                    <div class="col-md-12">
                        <div class="clearfix"></div>
                        <hr>
                        <div class="row">

                            <!-- Espaciador -->
                            <div class="col-md-3"></div>

                            <!-- Pago de Factura -->
                            <div class="col-md-3">
                                <br>
                                <div class="form-group">
                                    <label for="exampleInputuname">PAGO DE FACTURA</label>
                                    <div class="input-group">
                                        <div class="input-group-addon"><b>Abonar:</b><i class=""></i></div>
                                        <input type="number" class="form-control text-right" id="exampleInputuname"
                                            placeholder="0.00" formControlName="abono" (input)="actualizarSaldoXML()" min="0">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="input-group">
                                        <div class="input-group-addon"><b>Saldo:</b>&nbsp;&nbsp;&nbsp;&nbsp;<i
                                                class=""></i></div>
                                        <input type="number" class="form-control text-right" id="exampleInputuname"
                                            placeholder="{{ facturaFormXML.get('saldo')?.value }}" formControlName="saldo"
                                            readonly>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="input-group">
                                        <div class="input-group-addon"><b>Total:</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i
                                                class=""></i></div>
                                        <input type="number" class="form-control text-right" id="exampleInputuname"
                                            placeholder="{{ importeTotal.toFixed(2) }}" formControlName="importe_total"
                                            readonly>
                                    </div>
                                </div>
                            </div>

                            <!-- Detalle -->
                            <div class="col-md-3">
                                <div class="pull-right m-t-30 text-right">
                                    <p>SUBTOTAL SIN IMPUESTOS: </p>
                                    <p>SUBTOTAL 12%: </p>
                                    <p>SUBTOTAL 0%: </p>
                                    <p>SUBTOTAL NO OBJETO DE IVA: </p>
                                    <p>SUBTOTAL EXCENTO DE IVA: </p>
                                    <p>TOTAL DESCUENTO: </p>
                                    <p>ICE:</p>
                                    <p>IVA 12%: </p>
                                    <h3 class="left-align"><b>VALOR TOTAL: </b></h3>
                                </div>
                            </div>

                            <!-- Valores -->
                            <div class="col-md-3">
                                <div class="pull-right m-t-30 text-right">
                                    <p>$ {{ totalSinImpuestos.toFixed(2) }} </p>
                                    <p>$ 0.00 </p>
                                    <p>$ 0.00 </p>
                                    <p>$ 0.00 </p>
                                    <p>$ 0.00 </p>
                                    <p>$ 0.00 </p>
                                    <p>$ {{ totalDescuento.toFixed(2) }}</p>
                                    <p>$ {{ valor2.toFixed(2) }}</p>
                                    <h3>$ {{ importeTotal.toFixed(2) }}</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Modal Footer -->
            <div class="col-md-12">
                <hr>
                <div class="float-right modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" (click)="crearFacturaXML();"
                        data-dismiss="modal">Cargar</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Update Factura -->
<div class="modal fade modal-principal" id="exampleModalU" tabindex="-1" role="dialog"
    aria-labelledby="exampleModalLabel1" #miModal>
    <div class="modal-dialog" role="document" style="width: 100%;" max-width="1000px;">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title" id="exampleModalLabel1">Editar Factura</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">
                <div class="text-center">
                    <h3><b>FACTURA COMPRA</b></h3>
                    <h5><b># </b> {{ codigo}}</h5>
                </div>
                <form autocomplete="off" [formGroup]="facturaFormU">

                    <!-- Factura Form Data-->
                    <div class="row">

                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Identificación</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-id-badge"></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname"
                                        placeholder="Identificación" formControlName="identificacion" readonly>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Razó Social</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-user"></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname"
                                        placeholder="Razón Social" formControlName="razon_social" readonly>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Dirección</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-location-pin"></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname"
                                        placeholder="Dirección" formControlName="direccion" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Teléfono</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-mobile"></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname"
                                        placeholder="Teléfono" formControlName="telefono" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Email</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-email"></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname" placeholder="Email"
                                        formControlName="email" readonly>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Forma de pago</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-credit-card"></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname"
                                        placeholder="Forma de Pago" formControlName="id_forma_pago" readonly>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Asiento</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-file"></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname" placeholder="Asiento"
                                        formControlName="id_asiento" readonly>
                                </div>
                            </div>
                        </div>

                        <!--
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Código</label>
                                <div class="input-group">
                                    <div class="input-group-addon">#<i class=""></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname" placeholder="Código"
                                        formControlName="codigo" readonly>
                                </div>
                            </div>
                        </div>
                        -->

                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Fecha Emisión</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-calendar"></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname"
                                        placeholder="Fecha Emisión" formControlName="fecha_emision"
                                        [value]="getFormattedFechaEmision()" readonly>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Fecha vencimiento</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-calendar"></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname"
                                        placeholder="Fecha Vencimiento" formControlName="fecha_vencimiento"
                                        [value]="getFormattedFechaVencimiento()" readonly>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="exampleInputuname">Estado de pago</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="ti-check-box"></i></div>
                                    <input type="text" class="form-control" id="exampleInputuname"
                                        placeholder="Estado de Pago" formControlName="estado_pago" readonly>
                                </div>
                            </div>
                        </div>


                        <div class="col">
                            <div class="text-danger">
                                <p *ngIf="campoNoValido('estado_pago',facturaFormU)">El campo es obligatorio</p>
                            </div>
                        </div>

                        <hr>
                    </div>

                    <!-- Detalle Table Data -->
                    <div class="table-responsive">

                        <table id="demo-foo-addrow"
                            class="table m-t-30 table-hover contact-list footable-loaded footable" data-page-size="10">
                            <thead>
                                <tr>
                                    <th class="footable-sortable">#<span class="footable-sort-indicator"></span>
                                    </th>
                                    <th class="footable-sortable text-center">Código <span
                                            class="footable-sort-indicator"></span>
                                    </th>
                                    <th class="footable-sortable">Cantidad<span class="footable-sort-indicator"></span>
                                    </th>
                                    <th class="footable-sortable">Descripcion<span
                                            class="footable-sort-indicator"></span>
                                    </th>

                                    <th class="footable-sortable">Precio Unitario<span
                                            class="footable-sort-indicator"></span>
                                    </th>
                                    <th class="footable-sortable">Descuento<span class="footable-sort-indicator"></span>
                                    </th>
                                    <th class="footable-sortable">Tarifa<span class="footable-sort-indicator"></span>
                                    </th>
                                    <th class="footable-sortable">Valor<span class="footable-sort-indicator"></span>
                                    </th>
                                    <th class="footable-sortable">Precio Total<span
                                            class="footable-sort-indicator"></span></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let df of detalle_facturas let i = index">
                                    <td><span class="footable-toggle"></span>{{ i + 1 }}</td>
                                    <td class="text-center">{{df.id_producto}}</td>
                                    <td>{{df.cantidad}}</td>
                                    <td>{{df.descripcion}}</td>
                                    <td>{{df.precio_unitario}}</td>
                                    <td>{{df.descuento}}</td>
                                    <td>{{df.tarifa}}</td>
                                    <td>{{df.valor}}</td>
                                    <td>{{df.precio_total_sin_impuesto}}</td>
                                    <td class="text-right">{{df.tarifa}}</td>
                                    <ng-template #inactivoOption>
                                    </ng-template>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <!--paginador-->
                                </tr>
                            </tfoot>
                        </table>
                    </div>

                    <!-- Factura Form 2 -->
                    <div class="col-md-12">
                        <div class="clearfix"></div>
                        <hr>
                        <div class="row">

                            <div class="col-md-3"></div> <!-- Espaciador -->
                            <div class="col-md-3">
                                <br>
                                <div class="form-group">
                                    <label for="exampleInputuname">PAGO DE FACTURA</label>
                                    <div class="input-group">
                                        <div class="input-group-addon"><b>Abonar:</b><i class=""></i></div>
                                        <input type="number" class="form-control text-right" id="exampleInputuname"
                                            placeholder="0.00" formControlName="abono" (input)="actualizarSaldoU()" min="0">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="input-group">
                                        <div class="input-group-addon"><b>Saldo:</b>&nbsp;&nbsp;&nbsp;&nbsp;<i
                                                class=""></i></div>
                                        <input type="number" class="form-control text-right" id="exampleInputuname"
                                            placeholder="Saldo" formControlName="saldo" readonly>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="input-group">
                                        <div class="input-group-addon"><b>Total:</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i
                                                class=""></i></div>
                                        <input type="number" class="form-control text-right" id="exampleInputuname"
                                            placeholder="Valor Total" formControlName="importe_total" readonly>
                                    </div>
                                </div>
                            </div>
                            <!-- Detalle -->
                            <div class="col-md-3">
                                <div class="pull-right m-t-30 text-right">
                                    <p>SUBTOTAL SIN IMPUESTOS: </p>
                                    <p>SUBTOTAL 12%: </p>
                                    <p>SUBTOTAL 0%: </p>
                                    <p>SUBTOTAL NO OBJETO DE IVA: </p>
                                    <p>SUBTOTAL EXCENTO DE IVA: </p>
                                    <p>TOTAL DESCUENTO: </p>
                                    <p>ICE:</p>
                                    <p>IVA 12%: </p>
                                    <h3 class="left-align"><b>VALOR TOTAL: </b></h3>
                                </div>
                            </div>
                            <div class="col-md-3">

                                <div class="pull-right m-t-30 text-right">
                                    <p>$ {{ total_sin_impuesto }}</p>
                                    <p>$ 0.00</p>
                                    <p>$ 0.00</p>
                                    <p>$ 0.00</p>
                                    <p>$ 0.00</p>
                                    <p>$ {{ total_descuento }}</p>
                                    <p>$ 0.00</p>
                                    <p>$ {{ valor}}</p>
                                    <h3>$ {{ importe_total }}</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Modal Footer -->
            <div class="col-md-12">
                <hr>
                <div class="float-right modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" (click)="actualizarFactura();"
                        data-dismiss="modal">Actualizar</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Create Proveedor -->
<div class="modal fade modal-custom" id="modalProveedor" tabindex="-1" role="dialog"
    aria-labelledby="modalProveedorLabel1" #miModalProveedor>
    <div class="modal-dialog" role="document">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title" id="modalProveedorLabel">Nuevo Proveedor</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">
                <form autocomplete="off" [formGroup]="proveedorForm">
                    <div class="form-group">
                        <label for="exampleInputuname">Identificación</label>
                        <div class="input-group">
                            <div class="input-group-addon"><i class="ti-user"></i></div>
                            <input type="text" class="form-control" id="exampleInputuname" placeholder="Identificación"
                                formControlName="identificacion">
                        </div>
                        <label for="exampleInputuname">Razón Social</label>
                        <div class="input-group">
                            <div class="input-group-addon"><i class="ti-user"></i></div>
                            <input type="text" class="form-control" id="exampleInputuname" placeholder="Razón Social"
                                formControlName="razon_social">
                        </div>
                        <label for="exampleInputuname">Nombre Comercial</label>
                        <div class="input-group">
                            <div class="input-group-addon"><i class="ti-user"></i></div>
                            <input type="text" class="form-control" id="exampleInputuname"
                                placeholder="Nombre Comercial" formControlName="nombre_comercial">
                        </div>
                        <label for="exampleInputuname">Dirección</label>
                        <div class="input-group">
                            <div class="input-group-addon"><i class="ti-user"></i></div>
                            <input type="text" class="form-control" id="exampleInputuname" placeholder="Dirección"
                                formControlName="direccion">
                        </div>
                        <label for="exampleInputuname">Telefóno</label>
                        <div class="input-group">
                            <div class="input-group-addon"><i class="ti-user"></i></div>
                            <input type="text" class="form-control" id="exampleInputuname" placeholder="Telefóno"
                                formControlName="telefono">
                        </div>
                        <label for="exampleInputuname">Email</label>
                        <div class="input-group">
                            <div class="input-group-addon"><i class="ti-user"></i></div>
                            <input type="text" class="form-control" id="exampleInputuname" placeholder="Email"
                                formControlName="email">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col text-danger">
                            <p *ngIf="campoNoValido('identificacion',proveedorForm)"> El campo es obligatorio</p>
                            <p *ngIf="campoNoValido('razon_social',proveedorForm)"> El campo es obligatorio</p>
                            <p *ngIf="campoNoValido('nombre_comercial',proveedorForm)"> El campo es obligatorio</p>
                            <p *ngIf="campoNoValido('direccion',proveedorForm)"> El campo es obligatorio</p>
                            <p *ngIf="campoNoValido('telefono',proveedorForm)"> El campo es obligatorio</p>
                            <p *ngIf="campoNoValido('email',proveedorForm)"> El campo es obligatorio</p>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" (click)="crearProveedor(); cargarProveedores()
                " data-dismiss="modal">Crear</button>
            </div>

        </div>
    </div>
</div>



<style>
    /* Table Data Factura */

    /* CSS personalizado para espaciar los botones */
    .float-left .btn {
        margin-right: 10px;
        /* Ajusta este valor según el espacio deseado */
    }

    /* Modal Create Factura */

    .modal-dialog {
        max-width: 80%;
        /* Ajusta el valor según tus necesidades */
        margin: 30px auto;
    }

    .left-align {
        /* Alinea a la izquierda la etiqueta  VALOR TOTAL */
        text-align: left;
    }

    /* Modal Create Proveedor */

    .proveedores-filtrados {
        position: absolute;
        z-index: 9999;
        background-color: #fff;
        border: 1px solid #ccc;
        max-height: 200px;
        overflow-y: auto;
    }

    /* Modal Create Proveedor */

    .modal-custom .modal-dialog {
        max-width: 30%;
        /* Ajusta el valor según tus necesidades */
        margin: 30px auto;



    }

    /* Modal Upload XML */
    .custom-file-upload {
        display: inline-block;
        padding: 6px 20px;
        cursor: pointer;
        background-color: #007bff;
        color: #fff;
        border: 1px solid #007bff;
        border-radius: 5px;
    }

    .custom-file-upload:hover {
        background-color: #0056b3;
    }

    /*
    .custom-file-upload {
        display: inline-block;
        padding: 6px 20px;
        cursor: pointer;
        background-color: #007bff;
        color: #fff;
        border: 1px solid #007bff;
        border-radius: 5px;
    }

    .custom-file-upload:hover {
        background-color: #0056b3;
    }

    */
</style>